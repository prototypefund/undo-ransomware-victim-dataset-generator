import numpy as np
import matplotlib.pyplot as plt

families = {}

f = open("all.labels", "r")
line = f.readline()

# read labels and build families dict
for line in f.readlines():
    values = line.strip().split('\t')
    if "SINGLETON" not in values[1]:
        try:
            families[values[1]] = families[values[1]] + 1
        except KeyError:
            families[values[1]] = 1
f.close()

# filter families: only collections of ransomware with more than 100 samples are families
families = {k: v for k, v in families.iteritems() if v > 150}

bars = []
height = []

for key in families:
    bars.append(key)

for value in families.values():
    height.append(value)

print "Number of families: " + str(len(families))
 
x_pos = np.arange(len(bars))

plt.ylabel("Number of samples")
plt.xlabel("Ransomware family name")
plt.title("Ransomware families")

# create bars
pbars = plt.bar(x_pos, height, 0.8)
 
# create names on the x-axis
plt.xticks(x_pos, bars, rotation=-90)

for rect in pbars:
        height = rect.get_height()
        plt.text(rect.get_x() + rect.get_width()/2.0, height, '%d' % int(height), ha='center', va='bottom', rotation=-90, size=8)
 
plt.subplots_adjust(bottom=0.15)
# show graphic
plt.show()